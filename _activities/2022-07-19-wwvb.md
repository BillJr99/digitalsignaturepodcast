---
layout: activity
title: "Telling Time with WWVB"
permalink: /activities/wwvb

gradelevel: secondary
category: python
subject: computing

gitrepo: https://github.com/billjr99/wwvb

authors: "William M. Mongan"
date: 2022-07-19

summary: "In this activity, we will listen to a data broadcast of the current time using the WWVB radio station, and learn about radio modulation to send data around the world."

thumbnail: "https://upload.wikimedia.org/wikipedia/commons/3/3c/WWVB_Antenna.jpg"
---

## Getting Started

Imagine you wanted to send some information "over the air" to a classmate across the room.  Radio waves are a [form of light at frequencies that we can't see](https://www.vice.com/en/article/9an9m7/heres-what-wi-fi-would-look-like-if-we-could-see-it).  So let's use a flashlight.  You can turn the flashlight on and off to send information to your partner.  

We can send any amount of data over wireless radio signals, but let's start with a simple yes/no question.  You can make something up: do you have lunch during 4th period, is there a test today, or anything at all.  You can decide what yes and no mean.  What did you come up with?

Now let's ask a more interesting question: something with a number as an answer.  You could ask what time it is, or or many people are in your class today, or something like that.  What patterns did you use to represent "yes" and "no," and how did they differ from the way you represented numbers?

Now try asking what time it is (the hours and the minutes) as one question.  Things get trickier now, because you can send the number of hours, and then the number of minutes, but how will the other person know that you've switched from hours to minutes?  Also, if it's 11:59, that's a lot of flashes of light, if you're flashing one time to count each one.  Is there a better way?  Also, did you do anything to represent AM versus PM, and how could you handle that?

By blinking the light, you are introducing light at a certain frequency (or in the case of actual light, many frequencies).  By blinking the light in a pattern, you're **modulating** a signal onto that wave of light.  This is how radio works.  With amplitude modulation (AM) radio, you make the amplitude of the signal "louder" or "softer" to show changes in your signal.  Frequency modulation (FM) changes the frequency of the signal: for example, if a radio station is broadcasting at 102.9 MhZ in FM, it actually broadcasts between 102.8 and 103.1 MhZ: if you "listen" to all of those together, you'll see the signal move between those frequencies, higher and lower, as the signal changes.  The top signal in the graph below shows a modulated FM signal (the middle signal is the actual signal being modulated, and the bottom signal is the original radio frequency).  When the signal goes low, notice that the frequency at the top goes slightly below the original frequency, and as the signal goes up, the frequency goes slightly above the original frequency.

<a title="L31n42, CC0, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Frequency_modulation_(FM).svg"><img width="512" alt="Frequency modulation (FM)" src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Frequency_modulation_%28FM%29.svg/512px-Frequency_modulation_%28FM%29.svg.png"></a>  

We are going to use [Pulse-Width Modulation (PWM)](https://en.wikipedia.org/wiki/Pulse-width_modulation), so that we keep the flashlight on for a certain length of time to represent a digit or bit of information.  For example, a quick flash might mean a 0, a long flash might mean a 1.  What are some ways that you could tell time using PWM?

For example, you could send the hours and minutes one digit at a time.  So, if it's 9:58, you might send three signals: a 9, a 5, and an 8.  Maybe the flashlight stays on for 1 second for each digit value.  So you'd turn on the light for 9 seconds, then turn it off.  Then, turn it on for 5 seconds, and then off, and then on for 8 seconds, and then off.  This is a good start, but there are a few problems to work out:

1. What happens if the number of hours has 2 digits in it, like 10:58?
2. How do you handle AM versus PM?
3. How long do you have to keep the light on so that the other person can see it?  One second is a pretty long time, but what would happen if it was only one-tenth of a second per digit value?
4. Was it hard to tell apart a 1 from a 9?  How about a 7 from an 8?  Are we trying to send too many different types of values?  Could you come up with a solution that only sends a few types of values at a time, so you don't have so much to tell apart?

## WWVB

WWVB is a radio station operated by the National Institute of Standards and Technology (NIST) from Fort Collins, Colorado.  It broadcasts the current time and date on a 60 kHz channel, which reaches most of the continental United States for use by clocks and watches to automatically set the time.  This program reads and decodes 1000 Hz modulated audio according to the [WWVB](https://en.wikipedia.org/wiki/WWVB) modulation standard.  

This low frequency uses ground propagation to reach most of the country, and although best reception can be found during the overnight hours, it works remarkably well most days on the east coast as well.  However, a properly tuned antenna would need to be some large proportion of the wavelength of the signal, and even a one-quarter wavelength antenna at this frequency would measure about 3 quarters of a mile in length!  Because the WWVB signal consists of a slow and simple modulation strategy, its signal can be heard by devices with tiny inefficient antennas (small enough to fit in a wristwatch!).  

This modulation strategy is called Pulse-Width Modulation.  WWVB uses three kinds of data values that it sends using this modulation: a 0, a 1, and a marker bit.  Sending a single bit takes one whole second, and during that second, a weak attenuated signal is sent followed by a stronger signal.  The duration (or width) of that attenuated signal tells us what kind of bit we have.  Here are the durations of each bit sent in a one second period:

|   **Bit**  | **Attenuated Signal Width** | **Strong Signal Width** |
|:----------:|:---------------------------:|-------------------------|
|    **0**   |            200 ms           |          800 ms         |
|    **1**   |            500 ms           |          500 ms         |
| **Marker** |            800 ms           |          200 ms         |

Here is an example signal that sends a marker bit followed by two zero bits.  Notice that the first bit is quiet for almost one second (0.8 seconds), and then loud for the remainder of the second (0.2 seconds).  That's a marker.  The second and third bits reverse that trend, and a requiet for only 0.2 seconds and then loud for the remainder of the second (0.8 seconds).  These are zero bits.  This signal transmitted a marker, followed by a 0, followed by a 0.

![A marker followed by two zero bits from WWVB using PWM](https://github.com/BillJr99/WWVB/blob/main/marker-zero-zero.png?raw=true)

Here's another example that sends a zero, a one, and a one bit.

![A zero followed by two one bits from WWVB using PWM](https://github.com/BillJr99/WWVB/blob/main/zero-one-one.png?raw=true)

If we listen carefully (or observe the strength of the radio signal), we can decipher the entire code.  Over the course of one minute, WWVB will send 60 bit signals.  Each one tells us something about the current time.  Here's what they mean:

| **Bit** |                                        **Meaning**                                        |
|:-------:|:-----------------------------------------------------------------------------------------:|
|  **0**  |                                           Marker                                          |
|  **1**  |                              Add 40 to the number of minutes                              |
|  **2**  |                              Add 20 to the number of minutes                              |
|  **3**  |                              Add 10 to the number of minutes                              |
|  **4**  |                                           Unused                                          |
|  **5**  |                               Add 8 to the number of minutes                              |
|  **6**  |                               Add 4 to the number of minutes                              |
|  **7**  |                               Add 2 to the number of minutes                              |
|  **8**  |                               Add 1 to the number of minutes                              |
|  **9**  |                                           Marker                                          |
|  **10** |                                           Unused                                          |
|  **11** |                                           Unused                                          |
|  **12** |           Add 20 to the number of hours (0 is midnight, 13 is 1 PM, 23 is 11 PM)          |
|  **13** |                               Add 10 to the number of hours                               |
|  **14** |                                           Unused                                          |
|  **15** |                                Add 8 to the number of hours                               |
|  **16** |                                Add 4 to the number of hours                               |
|  **17** |                                Add 2 to the number of hours                               |
|  **18** |                                Add 1 to the number of hours                               |
|  **19** |                                           Marker                                          |
|  **20** |                                           Unused                                          |
|  **21** |                                           Unused                                          |
|  **22** |                  Add 200 to the number of days this year (1 is January 1)                 |
|  **23** |                               Add 100 to the day of the year                              |
|  **24** |                                           Unused                                          |
|  **25** |                               Add 80 to the day of the year                               |
|  **26** |                               Add 40 to the day of the year                               |
|  **27** |                               Add 20 to the day of the year                               |
|  **28** |                               Add 10 to the day of the year                               |
|  **29** |                                           Marker                                          |
|  **30** |                                Add 8 to the day of the year                               |
|  **31** |                                Add 4 to the day of the year                               |
|  **32** |                                Add 2 to the day of the year                               |
|  **33** |                                Add 1 to the day of the year                               |
|  **34** |                                           Unused                                          |
|  **35** |                                           Unused                                          |
|  **36** |                                   DUT1 Time Correction +                                  |
|  **37** |                                   DUT1 Time Correction -                                  |
|  **38** |                                   DUT1 Time Correction +                                  |
|  **39** |                                           Marker                                          |
|  **40** |     DUT1 Time Correction of 0.8 seconds (add or subtract this from the current minute)    |
|  **41** |                            DUT1 Time Correction of 0.4 seconds                            |
|  **42** |                            DUT1 Time Correction of 0.2 seconds                            |
|  **43** |                            DUT1 Time Correction of 0.1 seconds                            |
|  **44** |                                           Unused                                          |
|  **45** |             Add 80 to the 2-digit year (you need to know the current century!)            |
|  **46** |                                 Add 40 to the 2-digit year                                |
|  **47** |                                 Add 20 to the 2-digit year                                |
|  **48** |                                 Add 10 to the 2-digit year                                |
|  **49** |                                           Marker                                          |
|  **50** |                                 Add 8 to the 2-digit year                                 |
|  **51** |                                 Add 4 to the 2-digit year                                 |
|  **52** |                                 Add 2 to the 2-digit year                                 |
|  **53** |                                 Add 1 to the 2-digit year                                 |
|  **54** |                                           Unused                                          |
|  **55** |                                         Leap Year?                                        |
|  **56** |                                        Leap Second?                                       |
|  **57** | Daylight Saving Time? (00 = standard time, 01 = DST ending, 02 = DST beginning= 03 = DST) |
|  **58** |                                   Daylight Saving Time?                                   |
|  **59** |                                           Marker                                          |

You could tune in and listen to the signal, and you'd hear something like this:

<iframe width="560" height="315" src="https://www.youtube.com/embed/0m5AT67Apvs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

The tone is modulated onto the 60 kHz signal at 1000 Hz, and you can hear it get weaker and stronger each second.  In theory, an attentive human with a sharp ear could listen and figure out the current time (or at least the time exactly one minute ago).  In practice, we use circuits and programming to decode the signal automatically.  

## Running the Programs

### Youtube Decoder

The wwvb-youtube-decoder.py program downloads the audio from [this WWVB sample](https://www.youtube.com/watch?v=0m5AT67Apvs).  It is run via:

`python wwvb-youtube-decoder.py`

and will print out the current time and date as of the time of that recording.

### WAV Decoder

If you have your own audio file sample of WWVB already, you can run:

`python wwvb-wav-decoder.py <input.wav>`

to decode its audio and print the associated time and date.

### WWVB Audio Simulator

If you can't record the WWVB signal yourself, you can use this program to generate a one-minute WAV file simulating the WWVB signal for the current time and date.  You can then run the WAV Decoder to decode this audio.

`python wwvb-generator.py`

This will generate a file called `output.wav` by default.

### WAV Plotter

If you'd like to generate the waveforms shown above, you can run the WAV Plotter on a given audio sample:

`python wavplot.py <input.wav>`

### The Finished Project

Here's my finished product, available at [https://www.github.com/BillJr99/WWVB/](https://www.github.com/BillJr99/WWVB/):
